<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>AR Vehicle Garage</title>

<!-- DO NOT CHANGE -->
<script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
<script src="https://raw.githack.com/AR-js-org/AR.js/3.3.2/aframe/build/aframe-ar.js"></script>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">

<style>
*{ box-sizing:border-box; }

body{
  margin:0;
  overflow:hidden;
  font-family:'Inter',sans-serif;
  background:#0f0f10;
  color:white;
}

/* ---------- Top Info ---------- */
#info{
  position:absolute;
  top:20px;
  left:50%;
  transform:translateX(-50%);
  padding:12px 20px;
  background:rgba(20,20,22,.9);
  border-radius:14px;
  font-size:17px;
  font-weight:600;
  z-index:5;
  border:1px solid rgba(255,255,255,.1);
}

/* ---------- Buttons ---------- */
.btn{
  position:absolute;
  bottom:20px;
  padding:12px 18px;
  background:rgba(30,30,32,.9);
  border:1px solid rgba(255,255,255,.12);
  color:white;
  border-radius:14px;
  font-size:16px;
  font-weight:600;
  cursor:pointer;
  transition: all 0.2s;
}

.btn:hover{
  background:rgba(40,40,42,.95);
  transform: translateY(-1px);
}

#left{ left:16px; }
#right{ right:16px; }

/* Side-by-side center buttons */
#favorite{
  left:50%;
  transform:translateX(-110%);
}
#addCollection{
  left:50%;
  transform:translateX(10%);
}

/* ---------- Favorite Stars ---------- */
#favoriteMenu{
  position:absolute;
  bottom:78px;
  left:50%;
  transform:translateX(-50%);
  padding:10px 16px;
  background:rgba(20,20,22,.92);
  border-radius:16px;
  display:none;
  z-index:5;
  border:1px solid rgba(255,255,255,.1);
}

.star{
  font-size:28px;
  cursor:pointer;
  color:rgba(255,255,255,.25);
  transition: all 0.2s;
}
.star:hover{
  color:rgba(255,213,79,.5);
}
.star.active{ color:#FFD54F; }

/* ---------- Toast ---------- */
#toast{
  position:absolute;
  top:72px;
  left:50%;
  transform:translateX(-50%);
  background:#1f7aff;
  padding:8px 14px;
  border-radius:12px;
  font-size:14px;
  opacity:0;
  transition:opacity .3s;
  z-index:6;
}

/* ---------- Loading ---------- */
#loading{
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  background:#0f0f10;
  z-index:10;
  font-size:18px;
  font-weight:600;
  flex-direction:column;
}

.spinner{
  width:40px;
  height:40px;
  border:4px solid rgba(255,255,255,.1);
  border-top-color:#1f7aff;
  border-radius:50%;
  animation:spin 1s linear infinite;
  margin-bottom:12px;
}

@keyframes spin{
  to{ transform:rotate(360deg); }
}

/* ---------- Collection ---------- */
#collection{
  position:absolute;
  right:16px;
  top:90px;
  width:260px;
  background:rgba(20,20,22,.95);
  border-radius:16px;
  padding:14px;
  font-size:14px;
  display:none;
  z-index:6;
  border:1px solid rgba(255,255,255,.1);
}

#collection h3{
  margin:0 0 12px 0;
  font-size:16px;
  color:#1f7aff;
}

.collection-item{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:8px;
  padding:8px;
  background:rgba(255,255,255,.05);
  border-radius:8px;
}

.collection-item:hover{
  background:rgba(255,255,255,.08);
}

.remove-btn{
  background:#ff4d4d;
  border:none;
  color:white;
  padding:4px 8px;
  border-radius:6px;
  cursor:pointer;
  font-size:12px;
  font-weight:600;
}

#collectionTotal{
  margin-top:12px;
  padding-top:12px;
  border-top:1px solid rgba(255,255,255,.1);
  font-weight:600;
  font-size:15px;
}

#clearCollection{
  margin-top:10px;
  width:100%;
  padding:8px;
  border:none;
  border-radius:10px;
  background:#ff4d4d;
  color:white;
  font-weight:600;
  cursor:pointer;
  transition: all 0.2s;
}

#clearCollection:hover{
  background:#e63939;
  transform: translateY(-1px);
}

/* ---------- Vehicle Specs ---------- */
#specs{
  position:absolute;
  left:16px;
  top:90px;
  width:240px;
  background:rgba(20,20,22,.95);
  border-radius:16px;
  padding:14px;
  font-size:13px;
  z-index:6;
  border:1px solid rgba(255,255,255,.1);
}

#specs h4{
  margin:0 0 10px 0;
  font-size:15px;
  color:#1f7aff;
}

.spec-row{
  display:flex;
  justify-content:space-between;
  padding:6px 0;
  border-bottom:1px solid rgba(255,255,255,.08);
}

.spec-row:last-child{
  border-bottom:none;
}

.spec-label{
  color:rgba(255,255,255,.6);
}

.spec-value{
  font-weight:600;
  color:white;
}

a-scene{ pointer-events:none; }
#info,#toast,.btn,#favoriteMenu,.star,#collection,#specs{ pointer-events:auto; }
</style>
</head>

<body>

<div id="info"></div>
<div id="toast"></div>
<div id="loading">
  <div class="spinner"></div>
  <div>Loading vehicle...</div>
  <div style="font-size:12px;color:rgba(255,255,255,.5);margin-top:8px;">Camera permission required</div>
</div>

<button id="left" class="btn">‚óÄ Prev</button>
<button id="favorite" class="btn">‚≠ê Favorite</button>
<button id="addCollection" class="btn">üì¶ Add to Collection</button>
<button id="right" class="btn">Next ‚ñ∂</button>

<div id="favoriteMenu">
  <span class="star" data-s="1">‚òÖ</span>
  <span class="star" data-s="2">‚òÖ</span>
  <span class="star" data-s="3">‚òÖ</span>
  <span class="star" data-s="4">‚òÖ</span>
  <span class="star" data-s="5">‚òÖ</span>
</div>

<div id="specs">
  <h4>üîß Vehicle Specs</h4>
  <div class="spec-row">
    <span class="spec-label">Type:</span>
    <span class="spec-value" id="specType">-</span>
  </div>
  <div class="spec-row">
    <span class="spec-label">Category:</span>
    <span class="spec-value" id="specCategory">-</span>
  </div>
  <div class="spec-row">
    <span class="spec-label">Price:</span>
    <span class="spec-value" id="specPrice">-</span>
  </div>
  <div class="spec-row">
    <span class="spec-label">Rating:</span>
    <span class="spec-value" id="specRating">Not rated</span>
  </div>
</div>

<div id="collection">
  <h3>üèÅ Your Collection</h3>
  <div id="collectionItems"></div>
  <div id="collectionTotal">Total Value: ‚Çπ0</div>
  <button id="clearCollection">Clear Collection</button>
</div>

<a-scene embedded vr-mode-ui="enabled:false"
         arjs="sourceType:webcam; debugUIEnabled:false;">
  <a-entity light="type:ambient;intensity:0.9"></a-entity>
  <a-entity light="type:directional;intensity:0.5" position="1 2 1"></a-entity>
  <a-entity light="type:point;intensity:0.3" position="-1 1 1"></a-entity>
  <a-entity camera></a-entity>
  <a-entity id="holder" position="0 0 -4"></a-entity>
</a-scene>

<script>
const vehicles=[
  {
    model:"models/bike/scene.gltf",
    name:"Sport Bike",
    price:"‚Çπ2,50,000",
    priceNum:250000,
    scale:.4,
    type:"Motorcycle",
    category:"Sport"
  },
  {
    model:"models/bus/scene.gltf",
    name:"City Bus",
    price:"‚Çπ45,00,000",
    priceNum:4500000,
    scale:2,
    type:"Public Transport",
    category:"Commercial"
  },
  {
    model:"models/car/scene.gltf",
    name:"Sedan Car",
    price:"‚Çπ8,50,000",
    priceNum:850000,
    scale:.5,
    type:"Car",
    category:"Personal"
  },
  {
    model:"models/cruise_ship/scene.gltf",
    name:"Cruise Ship",
    price:"‚Çπ500,00,00,000",
    priceNum:5000000000,
    scale:.5,
    type:"Ship",
    category:"Marine"
  },
  {
    model:"models/metro/scene.gltf",
    name:"Metro Train",
    price:"‚Çπ30,00,00,000",
    priceNum:300000000,
    scale:.4,
    type:"Train",
    category:"Rail"
  },
  {
    model:"models/helicopter/scene.gltf",
    name:"Helicopter",
    price:"‚Çπ12,00,00,000",
    priceNum:120000000,
    scale:.4,
    type:"Aircraft",
    category:"Aviation"
  },
  {
    model:"models/submarine/scene.gltf",
    name:"Submarine",
    price:"‚Çπ200,00,00,000",
    priceNum:2000000000,
    scale:.4,
    type:"Submarine",
    category:"Marine"
  },
  {
    model:"models/plane/scene.gltf",
    name:"Airplane",
    price:"‚Çπ50,00,00,000",
    priceNum:500000000,
    scale:.4,
    type:"Aircraft",
    category:"Aviation"
  }
];

const holder=document.getElementById("holder");
const info=document.getElementById("info");
const loading=document.getElementById("loading");
const toast=document.getElementById("toast");

const collectionBtn=document.getElementById("addCollection");
const collectionBox=document.getElementById("collection");
const collectionItemsDiv=document.getElementById("collectionItems");
const collectionTotalDiv=document.getElementById("collectionTotal");
const clearCollectionBtn=document.getElementById("clearCollection");

const specType=document.getElementById("specType");
const specCategory=document.getElementById("specCategory");
const specPrice=document.getElementById("specPrice");
const specRating=document.getElementById("specRating");

let index=0;
let ratings={};
let yaw=0,pitch=0,scale=vehicles[0].scale;
let autoRotate=true;
let dragging=false,lx=0,ly=0;
let collection=[];

const model=document.createElement("a-entity");
holder.appendChild(model);

/* ---------- Helpers ---------- */
function showToast(t){
  toast.textContent=t;
  toast.style.opacity=1;
  setTimeout(()=>toast.style.opacity=0,1500);
}

function renderCollection(){
  collectionItemsDiv.innerHTML="";
  let total=0;
  collection.forEach((item,i)=>{
    total+=item.price*item.qty;
    const div=document.createElement("div");
    div.className="collection-item";
    div.innerHTML=`
      <div>
        <strong>${item.name}</strong><br>
        <small>x${item.qty} ‚Ä¢ ${item.priceStr}</small>
      </div>
      <button class="remove-btn" onclick="removeItem(${i})">‚úï</button>
    `;
    collectionItemsDiv.appendChild(div);
  });
  collectionTotalDiv.textContent=`Total Value: ‚Çπ${total.toLocaleString('en-IN')}`;
}

function removeItem(i){
  collection.splice(i,1);
  renderCollection();
  showToast("Removed from collection");
}

function updateSpecs(){
  const v=vehicles[index];
  specType.textContent=v.type;
  specCategory.textContent=v.category;
  specPrice.textContent=v.price;
  const r=ratings[v.name];
  specRating.textContent=r?`${'‚òÖ'.repeat(r)}${'‚òÜ'.repeat(5-r)}`:"Not rated";
}

/* ---------- Load ---------- */
function loadVehicle(i){
  loading.style.display="flex";
  model.setAttribute("gltf-model",vehicles[i].model);
  scale=vehicles[i].scale;
  model.object3D.scale.set(scale,scale,scale);
  yaw=pitch=0;
  model.object3D.rotation.set(0,0,0);
  info.textContent=`${vehicles[i].name} ‚Ä¢ ${vehicles[i].price}`;
  updateSpecs();
}

model.addEventListener("model-loaded",()=>loading.style.display="none");
model.addEventListener("model-error",(e)=>{
  console.error("Model failed to load:",e);
  loading.innerHTML='<div style="color:#ff4d4d;">Model failed to load<br><small>Check console (F12) for details</small></div>';
});

loadVehicle(0);

/* ---------- UI ---------- */
left.onclick=()=>{ 
  index=(index+vehicles.length-1)%vehicles.length; 
  loadVehicle(index); 
}

right.onclick=()=>{ 
  index=(index+1)%vehicles.length; 
  loadVehicle(index); 
}

favorite.onclick=()=>{
  favoriteMenu.style.display = favoriteMenu.style.display==="block"?"none":"block";
};

// Star rating
document.querySelectorAll('.star').forEach(star=>{
  star.onclick=()=>{
    const rating=parseInt(star.dataset.s);
    const vehicleName=vehicles[index].name;
    ratings[vehicleName]=rating;
    
    document.querySelectorAll('.star').forEach((s,i)=>{
      s.classList.toggle('active',i<rating);
    });
    
    updateSpecs();
    showToast(`Rated ${rating} stars!`);
  };
});

collectionBtn.onclick=()=>{
  const item=vehicles[index];
  const found=collection.find(c=>c.name===item.name);
  
  if(found){
    found.qty++;
  }else{
    collection.push({
      name:item.name,
      price:item.priceNum,
      priceStr:item.price,
      qty:1
    });
  }
  
  collectionBox.style.display="block";
  renderCollection();
  showToast("‚úì Added to collection");
};

clearCollectionBtn.onclick=()=>{
  if(confirm("Clear your entire collection?")){
    collection=[];
    renderCollection();
    showToast("Collection cleared");
  }
};

/* ---------- Mouse Rotation + Zoom ---------- */
document.addEventListener("mousedown",e=>{
  dragging=true;
  lx=e.clientX; 
  ly=e.clientY;
  autoRotate=false;
});

document.addEventListener("mousemove",e=>{
  if(!dragging) return;
  yaw+=(e.clientX-lx)*0.01;
  pitch+=(e.clientY-ly)*0.01;
  pitch=Math.max(-1.4,Math.min(1.4,pitch));
  lx=e.clientX; 
  ly=e.clientY;
  model.object3D.rotation.set(pitch,yaw,0);
});

document.addEventListener("mouseup",()=>{
  dragging=false;
  setTimeout(()=>autoRotate=true,2000);
});

document.addEventListener("wheel",e=>{
  e.preventDefault();
  scale+=e.deltaY*-0.001;
  scale=Math.max(.2,Math.min(2.5,scale));
  model.object3D.scale.set(scale,scale,scale);
});

/* ---------- Touch support ---------- */
let touchStartX=0,touchStartY=0;

document.addEventListener("touchstart",e=>{
  if(e.touches.length===1){
    touchStartX=e.touches[0].clientX;
    touchStartY=e.touches[0].clientY;
    dragging=true;
    autoRotate=false;
  }
});

document.addEventListener("touchmove",e=>{
  if(dragging && e.touches.length===1){
    const dx=e.touches[0].clientX-touchStartX;
    const dy=e.touches[0].clientY-touchStartY;
    yaw+=dx*0.01;
    pitch+=dy*0.01;
    pitch=Math.max(-1.4,Math.min(1.4,pitch));
    touchStartX=e.touches[0].clientX;
    touchStartY=e.touches[0].clientY;
    model.object3D.rotation.set(pitch,yaw,0);
  }
});

document.addEventListener("touchend",()=>{
  dragging=false;
  setTimeout(()=>autoRotate=true,2000);
});

/* ---------- Auto Rotate ---------- */
AFRAME.registerComponent("spin",{
  tick:()=>{
    if(autoRotate){
      yaw+=0.002;
      model.object3D.rotation.y=yaw;
    }
  }
});

model.setAttribute("spin","");

// Load saved ratings
const savedRatings=localStorage.getItem('garageRatings');
if(savedRatings){
  ratings=JSON.parse(savedRatings);
}

// Save ratings periodically
setInterval(()=>{
  localStorage.setItem('garageRatings',JSON.stringify(ratings));
},2000);
</script>

</body>
</html>
