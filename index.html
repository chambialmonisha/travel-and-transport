<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>TransportAR</title>

<!-- A-Frame & AR.js libraries -->
<script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
<script src="https://raw.githack.com/AR-js-org/AR.js/3.3.2/aframe/build/aframe-ar.js"></script>

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />

<style>
  * { box-sizing: border-box; }

  body {
    margin: 0;
    overflow: hidden;
    font-family: 'Inter', sans-serif;
    background: #0b0b0c;
    color: white;
  }

  /* ---------- Top Bar ---------- */
  #topBar {
    position: absolute;
    top: 0; left: 0; right: 0;
    padding: 12px 20px;
    background: linear-gradient(180deg, rgba(0,0,0,.7), transparent);
    display: flex;
    justify-content: space-between;
    align-items: center;
    z-index: 10;
  }

  #logo {
    font-size: 18px;
    font-weight: 700;
  }

  /* ---------- Info Card ---------- */
  #infoCard {
    position: absolute;
    top: 70px;
    left: 50%;
    transform: translateX(-50%);
    width: 90%;
    max-width: 320px;
    padding: 14px 16px;
    background: rgba(20,20,22,.95);
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,.08);
    z-index: 10;
  }

  #vehicleName {
    font-size: 18px;
    font-weight: 700;
  }

  #vehicleType {
    font-size: 13px;
    opacity: 0.7;
    margin-top: 4px;
  }

  #vehicleStats {
    display: flex;
    justify-content: space-between;
    margin-top: 10px;
    font-size: 12px;
    opacity: 0.7;
  }

  /* ---------- Controls ---------- */
  #controls {
    position: absolute;
    bottom: 20px;
    left: 0; right: 0;
    display: flex;
    justify-content: center;
    gap: 16px;
    z-index: 10;
  }

  .control-btn {
    width: 56px;
    height: 56px;
    border-radius: 50%;
    border: 1px solid rgba(255,255,255,.15);
    background: rgba(30,30,32,.9);
    color: white;
    font-size: 24px;
    cursor: pointer;
  }

  /* ---------- Side Actions ---------- */
  #sideActions {
    position: absolute;
    left: 16px;
    top: 50%;
    transform: translateY(-50%);
    display: flex;
    flex-direction: column;
    gap: 12px;
    z-index: 10;
  }

  .side-btn {
    width: 46px;
    height: 46px;
    border-radius: 50%;
    border: 1px solid rgba(255,255,255,.15);
    background: rgba(30,30,32,.9);
    color: white;
    font-size: 20px;
    cursor: pointer;
  }

  /* ---------- Loading ---------- */
  #loading {
    position: absolute;
    inset: 0;
    background: #0b0b0c;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 20;
  }

  #loadingText {
    font-size: 18px;
    margin-bottom: 12px;
  }

  #loadingBar {
    width: 200px;
    height: 4px;
    background: rgba(255,255,255,.1);
    overflow: hidden;
    border-radius: 4px;
  }

  #loadingProgress {
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg,#1f7aff,#0066ff);
  }

  /* ---------- Toast ---------- */
  #toast {
    position: absolute;
    top: 90px;
    left: 50%;
    transform: translateX(-50%);
    background: #1f7aff;
    padding: 10px 16px;
    border-radius: 12px;
    font-size: 14px;
    opacity: 0;
    transition: .3s;
    z-index: 30;
  }

  /* Disable pointer events on scene to avoid conflicts, but allow on UI elements */
  a-scene { pointer-events: none; }
  #topBar, #infoCard, #controls, #sideActions, #toast { pointer-events: auto; }
</style>
</head>
<body>

<!-- Top Bar -->
<div id="topBar">
  <div id="logo">üöó TransportAR</div>
</div>

<!-- Info Card -->
<div id="infoCard">
  <div id="vehicleName"></div>
  <div id="vehicleType"></div>
  <div id="vehicleStats">
    <span>üëÅÔ∏è <span id="viewCount">0</span></span>
    <span>‚≠ê <span id="avgRating">0.0</span></span>
  </div>
</div>

<!-- Side Actions -->
<div id="sideActions">
  <button class="side-btn" id="resetBtn" title="Reset View">üîÑ</button>
  <button class="side-btn" id="rotateBtn" title="Toggle Auto-Rotate">‚Üª</button>
</div>

<!-- Bottom Controls -->
<div id="controls">
  <button class="control-btn" id="prevBtn" title="Previous Vehicle">‚Äπ</button>
  <button class="control-btn" id="nextBtn" title="Next Vehicle">‚Ä∫</button>
</div>

<!-- Loading Overlay -->
<div id="loading">
  <div id="loadingText">Loading vehicle models‚Ä¶</div>
  <div id="loadingBar">
    <div id="loadingProgress"></div>
  </div>
</div>

<!-- Toast Notification -->
<div id="toast"></div>

<!-- AR Scene -->
<a-scene embedded vr-mode-ui="enabled:false"
         arjs="sourceType:webcam; debugUIEnabled:false;">
  <a-entity light="type:ambient; intensity:0.8"></a-entity>
  <a-entity light="type:directional; intensity:0.4" position="1 2 1"></a-entity>
  <a-entity camera></a-entity>
  <a-entity id="holder" position="0 0 -4"></a-entity>
</a-scene>

<script>
/* ---------- Data for Vehicles ---------- */
const vehicles = [
  
 
  { model:"https://raw.githubusercontent.com/chambialmonisha/travel-and-transport/e9e68e8a889fa78d63279741d1d9fe93d5454faf/models/car/scene.gltf", name:"Car", scale:0.5, type:"Road Transport", views:890, rating:4.2 },
  
 
];

const holder = document.getElementById("holder");
const loading = document.getElementById("loading");
const loadingProgress = document.getElementById("loadingProgress");
const toast = document.getElementById("toast");

let models = [];
let index = 0;
let yaw = 0;
let autoRotate = true;

/* ---------- Utility: Show Toast ---------- */
function showToast(message) {
  toast.textContent = message;
  toast.style.opacity = 1;
  setTimeout(() => toast.style.opacity = 0, 1800);
}

/* ---------- Load Models ---------- */
let loadedCount = 0;
vehicles.forEach((vehicle, i) => {
  const entity = document.createElement("a-entity");
  entity.setAttribute("gltf-model", vehicle.model);
  entity.object3D.visible = false; // hide until loaded
  holder.appendChild(entity);
  models.push(entity);

  entity.addEventListener("model-loaded", () => {
    console.log(`Loaded: ${vehicle.name}`);
    loadedCount++;
    loadingProgress.style.width = (loadedCount / vehicles.length) * 100 + "%";

    if (loadedCount === vehicles.length) {
      // All loaded
      loading.style.display = "none";
      showVehicle(0);
      showToast("Welcome to TransportAR üöÄ");
    }
  });
});

/* ---------- Show Vehicle ---------- */
function showVehicle(i) {
  models.forEach((m, idx) => m.object3D.visible = (idx === i));
  const v = vehicles[i];
  scale = v.scale;
  yaw = 0;

  models[i].object3D.scale.set(scale, scale, scale);
  models[i].object3D.rotation.set(0, 0, 0);
  document.getElementById("vehicleName").textContent = v.name;
  document.getElementById("vehicleType").textContent = v.type;
  document.getElementById("viewCount").textContent = v.views;
  document.getElementById("avgRating").textContent = v.rating.toFixed(1);
}

/* ---------- Controls ---------- */
document.getElementById("prevBtn").onclick = () => {
  index = (index - 1 + vehicles.length) % vehicles.length;
  showVehicle(index);
};

document.getElementById("nextBtn").onclick = () => {
  index = (index + 1) % vehicles.length;
  showVehicle(index);
};

document.getElementById("resetBtn").onclick = () => {
  showVehicle(index);
  showToast("View reset üîÑ");
};

document.getElementById("rotateBtn").onclick = () => {
  autoRotate = !autoRotate;
  showToast(autoRotate ? "Auto rotate ON" : "Auto rotate OFF");
};

/* ---------- Interaction: Drag to Rotate ---------- */
let dragging = false, lastX = 0;

document.addEventListener("mousedown", (e) => {
  dragging = true;
  lastX = e.clientX;
  autoRotate = false; // stop auto-rotation when dragging
});
document.addEventListener("mousemove", (e) => {
  if (!dragging) return;
  const deltaX = e.clientX - lastX;
  yaw += deltaX * 0.01;
  lastX = e.clientX;
  models[index].object3D.rotation.y = yaw;
});
document.addEventListener("mouseup", () => {
  dragging = false;
});

/* ---------- Auto Rotate Component ---------- */
AFRAME.registerComponent("spin", {
  tick: function () {
    if (autoRotate && models[index]) {
      yaw += 0.002;
      models[index].object3D.rotation.y = yaw;
    }
  }
});
holder.setAttribute("spin", "");
</script>

</body>
</html>
